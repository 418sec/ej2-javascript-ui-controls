!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-popups")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-grids","@syncfusion/ej2-data","@syncfusion/ej2-popups"],t):t(e.ej={},e.ej2Base,e.ej2Grids,e.ej2Data,e.ej2Popups)}(this,function(e,t,r,i,n){"use strict";function o(e){if(e.dataSource instanceof i.DataManager){var t=e.dataSource.adaptor;return t instanceof i.ODataAdaptor||t instanceof i.WebApiAdaptor||t instanceof i.WebMethodAdaptor||t instanceof i.CacheAdaptor||t instanceof i.UrlAdaptor}return!1}function a(e){var t;t=[];for(var i=0,n=Object.keys(e).length;i<n;i++){r.getObject("hasChildRecords",e[i])&&t.push(e[i])}return t}function s(e,r,i){var n,o=t.isNullOrUndefined(r.parentItem)?null:i.filter(function(e){return e.uniqueID===r.parentItem.uniqueID})[0];return null==o||(!e.initialRender||t.isNullOrUndefined(o[e.expandStateMapping])||o[e.expandStateMapping]?!1!==o.expanded&&(!o.parentItem||((n=i.filter(function(e){return e.uniqueID===o.parentItem.uniqueID})[0])&&e.initialRender&&!t.isNullOrUndefined(n[e.expandStateMapping])&&!n[e.expandStateMapping]?(n.expanded=!1,!1):(!n||!1!==n.expanded)&&(!n||s(e,n,i)))):(o.expanded=!1,!1))}function l(e){var r=[];if(t.isNullOrUndefined(e)||!e.hasChildRecords)return[];for(var i=e.childRecords,n=0,o=Object.keys(i).length;n<o;n++)r.push(i[n]),i[n].hasChildRecords&&(r=r.concat(l(i[n])));return r}function d(e){if(o(e)){var r=e.dataSource;return!t.isNullOrUndefined(r.ready)}return!0}function p(e){for(var t,r,i=[],n=0;n<e.length;n++){r=Object.keys(e[n]),t={};for(var o=0;o<r.length;o++)t[r[o]]=e[n][r[o]];i.push(t)}return i}function h(e){return delete e.hasChildRecords,delete e.childRecords,delete e.index,delete e.parentItem,delete e.parentIndex,delete e.level,e}var c=function(){return function(e){this.allowEditing=!0,this.edit={},this.allowReordering=!0,this.showColumnMenu=!0,this.allowFiltering=!0,this.allowSorting=!0,this.allowResizing=!0,this.filter={},t.merge(this,e)}}(),u=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),g=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},f=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return u(i,e),g([t.Collection([],r.Predicate)],i.prototype,"columns",void 0),g([t.Property("FilterBar")],i.prototype,"type",void 0),g([t.Property()],i.prototype,"mode",void 0),g([t.Property(!0)],i.prototype,"showFilterBarStatus",void 0),g([t.Property(1500)],i.prototype,"immediateModeDelay",void 0),g([t.Property()],i.prototype,"operators",void 0),g([t.Property(!1)],i.prototype,"ignoreAccent",void 0),g([t.Property("Parent")],i.prototype,"hierarchyMode",void 0),i}(t.ChildProperty),y=function(){function e(e){r.Grid.Inject(r.ColumnMenu),this.parent=e}return e.prototype.getColumnMenu=function(){return this.parent.grid.columnMenuModule.getColumnMenu()},e.prototype.destroy=function(){},e.prototype.getModuleName=function(){return"columnMenu"},e}(),m="rowDataBound",v="queryCellInfo",w="beforeDataBound",x="actionBegin",C="actionComplete",b="rowSelected",R="rowDeselected",S="toolbarClick",M="beforeExcelExport",P="beforePdfExport",E="resizeStop",I="expanded",O="collapsed",D="collapsing",A="remoteExpand",j="localPagedExpandCollapse",k="pagingActions",N="printGrid-Init",T="contextMenuOpen",L="crudAction",F="beginEdit",U="beginAdd",q="recordDoubleClick",B="cellSave",_="cellEdit",V="batchCancel",Q="key-pressed",H="double-tap",G=function(){function e(e){this.parent=e,r.Grid.Inject(r.Print),this.addEventListener()}return e.prototype.getModuleName=function(){return"print"},e.prototype.addEventListener=function(){this.parent.grid.on(N,this.printTreeGrid,this)},e.prototype.removeEventListener=function(){this.parent.grid.off(N,this.printTreeGrid)},e.prototype.printTreeGrid=function(e){var i=r.getObject("printgrid",e),n=r.getObject("element",e);i.addEventListener(v,this.parent.grid.queryCellInfo),i.addEventListener(m,this.parent.grid.rowDataBound),i.addEventListener(w,this.parent.grid.beforeDataBound),t.addClass([n],"e-treegrid")},e.prototype.print=function(){this.parent.grid.print()},e.prototype.destroy=function(){this.removeEventListener()},e}(),z=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),W=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},K=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return z(r,e),W([t.Property()],r.prototype,"fields",void 0),W([t.Property(!1)],r.prototype,"ignoreCase",void 0),W([t.Property()],r.prototype,"operators",void 0),W([t.Property()],r.prototype,"key",void 0),W([t.Property()],r.prototype,"hierarchyMode",void 0),r}(t.ChildProperty),J=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),X=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Y=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return J(r,e),X([t.Property("Row")],r.prototype,"mode",void 0),X([t.Property("Flow")],r.prototype,"cellSelectionMode",void 0),X([t.Property("Single")],r.prototype,"type",void 0),X([t.Property(!1)],r.prototype,"persistSelection",void 0),r}(t.ChildProperty),Z=function(){function e(e){this.parent=e}return e.prototype.RowModifier=function(e){if(e.data){var i,n=e.data,a=n.parentItem;if(t.isNullOrUndefined(n.parentIndex)||this.parent.allowPaging&&"Root"!==this.parent.pageSettings.pageSizeMode&&(!o(this.parent)||d(this.parent)))i=+e.row.getAttribute("aria-rowindex");else{i=n.parentIndex;(!(t.isNullOrUndefined(a[this.parent.expandStateMapping])||a[this.parent.expandStateMapping])||this.parent.enableCollapseAll||!s(this.parent,e.data,this.parent.grid.getCurrentViewRecords()))&&(e.row.style.display="none")}if(o(this.parent)&&!d(this.parent)){var l=this.parent,p=this.parent.getCurrentViewRecords().filter(function(e){return t.getValue(l.idMapping,e)===t.getValue(l.parentIdMapping,n)});if(p.length>0){var h=p[0].expanded?"table-row":"none";e.row.setAttribute("style","display: "+h+";")}}t.addClass([e.row],"e-gridrowindex"+i+"level"+e.data.level);r.getObject("isSummaryRow",e.data)&&t.addClass([e.row],"e-summaryrow"),this.parent.trigger(m,e)}},e.prototype.cellRender=function(e){if(e.data){var i=this.parent.grid,n=e.data,o=t.isNullOrUndefined(n.filterLevel)?n.level:n.filterLevel;if(i.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex){for(var a=t.createElement("div",{className:"e-treecolumn-container"}),l=t.createElement("span",{className:"e-icons e-none",styles:"width: 10px; display: inline-block"}),d=0;d<o;d++)a.appendChild(l.cloneNode());if(t.isNullOrUndefined(n.hasFilteredChildRecords)?n.hasChildRecords:n.hasFilteredChildRecords){t.addClass([e.cell],"e-treerowcell");var p=t.createElement("span",{className:"e-icons"}),h=void 0;h=this.parent.initialRender?n.expanded&&(t.isNullOrUndefined(n[this.parent.expandStateMapping])||n[this.parent.expandStateMapping])&&!this.parent.enableCollapseAll:n.expanded;var c=!0;t.isNullOrUndefined(n.parentIndex)||t.isNullOrUndefined(n[this.parent.expandStateMapping])||!n[this.parent.expandStateMapping]||this.parent.allowPaging&&"Root"!==this.parent.pageSettings.pageSizeMode||(c=!s(this.parent,e.data,this.parent.grid.getCurrentViewRecords())),t.addClass([p],h&&c?"e-treegridexpand":"e-treegridcollapse"),a.appendChild(p),l.style.width="7px",a.appendChild(l.cloneNode())}else o&&(a.appendChild(l.cloneNode()),a.appendChild(l.cloneNode()));var u=t.createElement("span",{className:"e-treecell"});this.parent.allowTextWrap&&(u.style.width="Calc(100% - "+10*a.querySelectorAll(".e-icons").length+"px)");var g=null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell").innerHTML:e.cell.innerHTML;u.innerHTML=g,a.appendChild(u),e.cell.innerHTML="",e.cell.appendChild(a)}if(r.getObject("isSummaryRow",e.data)){t.addClass([e.cell],"e-summarycell");var f=r.getObject(e.column.field,e.data);null!=e.cell.querySelector(".e-treecell")?e.cell.querySelector(".e-treecell").innerHTML=f:e.cell.innerHTML=f}this.parent.trigger(v,e)}},e}(),$=function(){function e(e){r.Grid.Inject(r.Sort),this.parent=e,this.taskIds=[],this.flatSortedData=[],this.storedIndex=-1,this.rootIndex=-1,this.isSelfReference=!t.isNullOrUndefined(this.parent.parentIdMapping),this.addEventListener()}return e.prototype.getModuleName=function(){return"sort"},e.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this),this.parent.on("createSort",this.createdSortedRecords,this),this.parent.on("createSortRecords",this.createSorting,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateModel",this.updateModel),this.parent.off("createSort",this.createdSortedRecords),this.parent.off("createSortRecords",this.createSorting))},e.prototype.createSorting=function(e){this.flatSortedData=[],this.createSortRecords(e)},e.prototype.createSortRecords=function(e){for(var i=r.getObject("modifiedData",e),n=r.getObject("parentRecords",e),o=r.getObject("parentIndex",e),a=r.getObject("filteredResult",e),s=0,l=Object.keys(i).length;s<l;s++){var d=i[s];this.storedIndex++;var p=0;if(d.index=this.storedIndex,t.isNullOrUndefined(d[this.parent.childMapping])||(d.childRecords=d[this.parent.childMapping],d.hasChildRecords=!0,d.expanded=!0),t.isNullOrUndefined(d.uniqueID)&&(d.uniqueID=r.getUid(this.parent.element.id+"_data_")),!t.isNullOrUndefined(n)){var h=t.extend({},n);delete h.childRecords,delete h[this.parent.childMapping],d.parentItem=h,d.parentUniqueID=h.uniqueID,p=n.level+1,d.parentIndex=o}d.level=p,t.isNullOrUndefined(d.parentIndex)?this.rootIndex=d.index:d.rootIndex=this.rootIndex,(t.isNullOrUndefined(d[this.parent.parentIdMapping])||d.parentItem)&&this.flatSortedData.push(d),t.isNullOrUndefined(d[this.parent.childMapping])||this.createSortRecords({modifiedData:d[this.parent.childMapping],parentRecords:d,parentIndex:this.storedIndex,filteredResult:a})}this.parent.notify("Sorting",{sortedData:this.flatSortedData,filteredData:a})},e.prototype.createdSortedRecords=function(e){for(var n=r.getObject("modifiedData",e),o=r.getObject("srtQry",e),a=r.getObject("parent",e),s=0,l=Object.keys(n).length;s<l;s++)if(!t.isNullOrUndefined(n[s].childRecords)||!t.isNullOrUndefined(n[s][a.childMapping])){var d=void 0;(d=t.isNullOrUndefined(n[s].childRecords)?new i.DataManager(n[s][a.childMapping]).executeLocal(o):new i.DataManager(n[s].childRecords).executeLocal(o)).length>0&&(n[s][a.childMapping]=d),this.createdSortedRecords({modifiedData:d,parent:a,srtQry:o})}},e.prototype.sortColumn=function(e,t,r){this.parent.grid.sortColumn(e,t,r)},e.prototype.removeSortColumn=function(e){this.parent.grid.removeSortColumn(e)},e.prototype.updateModel=function(){this.parent.sortSettings=this.parent.grid.sortSettings},e.prototype.clearSorting=function(){this.parent.grid.clearSorting(),this.updateModel()},e.prototype.destroy=function(){this.removeEventListener()},e}(),ee=function(){function e(e){this.parent=e,this.isParent=[],this.taskIds=[],this.hierarchyData=[],this.rootIndex=-1,this.storedIndex=-1,this.sortedData=[],this.isSortAction=!1,this.addEventListener(),this.dataResults={},this.isSelfReference=!t.isNullOrUndefined(this.parent.parentIdMapping)}return e.prototype.addEventListener=function(){this.parent.on("Sorting",this.sortedRecords,this),this.parent.grid.on("sorting-begin",this.beginSorting,this),this.parent.on("updateAction",this.updateData,this),this.parent.on(A,this.collectExpandingRecs,this),this.parent.on("dataProcessor",this.dataProcessor,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(A,this.collectExpandingRecs),this.parent.off("updateAction",this.updateData),this.parent.off("dataProcessor",this.dataProcessor),this.parent.off("Sorting",this.sortedRecords),this.parent.grid.off("sorting-begin",this.beginSorting))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.isRemote=function(){return this.parent.dataSource instanceof i.DataManager},e.prototype.convertToFlatData=function(e){var n=this;if(o(this.parent)&&!d(this.parent)&&e instanceof i.DataManager){var a=this.parent.dataSource;if(this.parent.parentIdMapping&&(this.parent.query=t.isNullOrUndefined(this.parent.query)?new i.Query:this.parent.query,this.parent.parentIdMapping&&this.parent.query.where(this.parent.parentIdMapping,"equal",null),!this.parent.hasChildMapping)){var s=(new i.Query).select([this.parent.parentIdMapping]);a.executeQuery(s).then(function(e){n.isParent=i.DataUtil.distinct(e.result,n.parent.parentIdMapping,!1);0===r.getObject("dataSource.requests",n.parent).filter(function(e){return"OK"!==e.httpRequest.statusText}).length&&(t.setValue("grid.contentModule.isLoaded",!0,n).parent,n.parent.grid.hideSpinner())})}}else if(e instanceof Array){this.hierarchyData=[],this.taskIds=[];for(var l=0;l<Object.keys(e).length;l++){var p=e[l];this.hierarchyData.push(t.extend({},p,!0)),t.isNullOrUndefined(p[this.parent.idMapping])||this.taskIds.push(p[this.parent.idMapping])}var h=new i.DataManager(e).executeLocal((new i.Query).where(this.parent.parentIdMapping,"notequal",null).group(this.parent.parentIdMapping));for(l=0;l<h.length;l++){var c=h[l],u=this.taskIds.indexOf(c.key);if(u>-1&&!t.isNullOrUndefined(c.key)){var g=r.iterateExtend(c.items);this.isSelfReference&&this.updateChildHierarchy(this.hierarchyData,this.hierarchyData[u],g)?(this.hierarchyData.splice(u,1),this.taskIds.splice(u,1)):this.hierarchyData[u][this.parent.childMapping]=g}}this.createRecords(this.hierarchyData),this.storedIndex=-1}},e.prototype.updateChildHierarchy=function(e,r,i){for(var n=r[this.parent.parentIdMapping],o=r[this.parent.idMapping],a=0;a<e.length;a++)if(e[a][this.parent.idMapping]===n){for(var s=e[a][this.parent.childMapping],l=0;l<s.length;l++)if(s[l][this.parent.idMapping]===o)return s[l][this.parent.childMapping]=i,!0}else t.isNullOrUndefined(e[this.parent.childMapping])||this.updateChildHierarchy(e[a][this.parent.childMapping],r,i);return!1},e.prototype.updateParentRemoteData=function(e){for(var r=0;r<e.length;r++)!e[r][this.parent.parentIdMapping]&&t.isNullOrUndefined(e[r].index)&&0!==e[r].index&&(e[r].level=0,e[r].index=Math.ceil(1e3*Math.random()),e[r].hasChildRecords=!0);return e},e.prototype.collectExpandingRecs=function(e){var o=this,a={row:e.parentRow,data:e.record};if(e.rows.length>0){e.record.expanded=!0;for(var s=0;s<e.rows.length;s++)e.rows[s].style.display="table-row";this.parent.trigger(I,a)}else{var l=this.parent.dataSource,d=t.isNullOrUndefined(this.parent.grid.query)?new i.Query:this.parent.grid.query,p=this.parent.query.queries.filter(function(e){return"onPage"!==e.fn&&"onWhere"!==e.fn});d.queries=p,d.where(this.parent.parentIdMapping,"equal",e.record[this.parent.idMapping]),n.showSpinner(this.parent.element),l.executeQuery(d).then(function(i){for(var s=o.parent.grid.currentViewData,l=s.indexOf(e.record),d=r.getObject("actual.nextLevel",i),p=i.result,h=0;h<p.length;h++)p[h].level=e.record.level+1,p[h].index=Math.ceil(1e3*Math.random()),p[h].parentItem=e.record,p[h].parentIndex=e.record.index,!p[h][o.parent.hasChildMapping]&&-1===o.isParent.indexOf(p[h][o.parent.idMapping])||d&&!d[h]||(p[h].hasChildRecords=!0,p[h].expanded=!1),s.splice(l+h+1,0,p[h]);t.setValue("result",s,i),t.setValue("action","beforecontentrender",i),o.parent.trigger(C,i),n.hideSpinner(o.parent.element),i.count=o.parent.grid.pageSettings.totalRecordsCount,t.getValue("grid.renderModule",o.parent).dataManagerSuccess(i),o.parent.trigger(I,a)})}},e.prototype.beginSorting=function(){this.isSortAction=!0},e.prototype.createRecords=function(e,i,n){for(var o=0,a=Object.keys(e).length;o<a;o++){var s=e[o],l=0;if(this.storedIndex++,s.index=this.storedIndex,t.isNullOrUndefined(s[this.parent.childMapping])||(s.childRecords=s[this.parent.childMapping],s.hasChildRecords=!0,s.expanded=!!t.isNullOrUndefined(s[this.parent.expandStateMapping])||s[this.parent.expandStateMapping]),s.index=(s.hasChildRecords,this.storedIndex),t.isNullOrUndefined(s[this.parent.parentIdMapping])&&this.parent.parentData.push(s),s.uniqueID=r.getUid(this.parent.element.id+"_data_"),!t.isNullOrUndefined(i)){var d=t.extend({},i);delete d.childRecords,delete d[this.parent.childMapping],s.parentItem=d,s.parentUniqueID=d.uniqueID,l=i.level+1,s.parentIndex=n}s.level=l,t.isNullOrUndefined(s.parentIndex)?this.rootIndex=s.index:s.rootIndex=this.rootIndex,(t.isNullOrUndefined(s[this.parent.parentIdMapping])||s.parentItem)&&this.parent.flatData.push(s),t.isNullOrUndefined(s[this.parent.childMapping])||this.createRecords(s[this.parent.childMapping],s,this.storedIndex)}Object.keys(e).length||(this.parent.flatData=[])},e.prototype.sortedRecords=function(e){var t=r.getObject("sortedData",e);if(this.sortedData=[],this.parent.grid.filterSettings.columns.length>0)for(var i=r.getObject("sortedData",e),n=r.getObject("filteredData",e),o=0,a=Object.keys(i).length;o<a;o++)for(var s=0,l=Object.keys(n).length;s<l;s++){r.getObject("uniqueID",i[o])===r.getObject("uniqueID",n[s])&&this.sortedData.push(i[o])}else for(o=0,a=Object.keys(t).length;o<a;o++)this.sortedData.push(t[o])},e.prototype.dataProcessor=function(e){var n=this.parent.flatData,o=this.parent.flatData.length;if(this.parent.grid.allowFiltering&&this.parent.grid.filterSettings.columns.length||this.parent.grid.searchSettings.key.length>0){var a=new i.Query,s=r.getObject("query",e);t.isNullOrUndefined(s)&&(s=new i.Query,s=t.getValue("grid.renderModule.data",this.parent).filterQuery(s),s=t.getValue("grid.renderModule.data",this.parent).searchQuery(s));var l=s.queries.filter(function(e){return"onWhere"===e.fn}),d=s.queries.filter(function(e){return"onSearch"===e.fn});a.queries=l.concat(d);var p=new i.DataManager(this.parent.flatData).executeLocal(a);if(this.parent.notify("updateFilterRecs",{data:p}),n=this.dataResults.result,this.dataResults.result=null,this.parent.grid.aggregates.length>0){var h=r.getObject("query",e);t.isNullOrUndefined(s)&&(s=t.getValue("grid.renderModule.data",this.parent).aggregateQuery(new i.Query));var c=h.queries.filter(function(e){return"onAggregates"===e.fn});n=this.parent.summaryModule.calculateSummaryValue(c,n,!0)}}if(this.parent.grid.aggregates.length&&0===this.parent.grid.sortSettings.columns.length&&0===this.parent.grid.filterSettings.columns.length&&!this.parent.grid.searchSettings.key.length){s=r.getObject("query",e);t.isNullOrUndefined(s)&&(s=t.getValue("grid.renderModule.data",this.parent).aggregateQuery(new i.Query));c=s.queries.filter(function(e){return"onAggregates"===e.fn});n=this.parent.summaryModule.calculateSummaryValue(c,this.parent.flatData,!0)}if(this.parent.grid.sortSettings.columns.length>0||this.isSortAction){this.isSortAction=!1;var u=void 0;if("collapse"!==e.action&&"expand"!==e.action){u=!this.isSelfReference&&this.parent.childMapping.length>0?r.iterateExtend(this.parent.dataSource):r.iterateExtend(this.parent.parentData);h=r.getObject("query",e);this.parent.sortModule=new $(this.parent);for(var g=new i.Query,f=this.parent.grid.sortSettings.columns.length-1;f>=0;f--)g.sortBy(this.parent.grid.sortSettings.columns[f].field,this.parent.grid.sortSettings.columns[f].direction);var y=new i.DataManager(u).executeLocal(g);this.parent.notify("createSort",{modifiedData:y,parent:this.parent,srtQry:g}),this.parent.notify("createSortRecords",{modifiedData:y,parentRecords:null,parentIndex:null,filteredResult:n})}if(n=this.sortedData,this.parent.notify("updateModel",{}),this.parent.grid.aggregates.length>0){c=(h=r.getObject("query",e)).queries.filter(function(e){return"onAggregates"===e.fn});n=this.parent.summaryModule.calculateSummaryValue(c,this.sortedData,!1)}}o=n.length,this.parent.allowPaging&&(this.parent.notify(k,{result:n,count:o}),n=this.dataResults.result,o=this.dataResults.count),e.result=n,e.count=o,this.parent.notify("updateResults",e)},e.prototype.updateData=function(e){this.dataResults=e},e}();!function(e){e[e.Add=0]="Add",e[e.Edit=1]="Edit",e[e.Update=2]="Update",e[e.Delete=3]="Delete",e[e.Cancel=4]="Cancel",e[e.Search=5]="Search",e[e.ExpandAll=6]="ExpandAll",e[e.CollapseAll=7]="CollapseAll",e[e.ExcelExport=8]="ExcelExport",e[e.PdfExport=9]="PdfExport",e[e.CsvExport=10]="CsvExport",e[e.Print=11]="Print"}(e.ToolbarItem||(e.ToolbarItem={})),function(e){e[e.AutoFit=0]="AutoFit",e[e.AutoFitAll=1]="AutoFitAll",e[e.SortAscending=2]="SortAscending",e[e.SortDescending=3]="SortDescending",e[e.Edit=4]="Edit",e[e.Delete=5]="Delete",e[e.Save=6]="Save",e[e.Cancel=7]="Cancel",e[e.PdfExport=8]="PdfExport",e[e.ExcelExport=9]="ExcelExport",e[e.CsvExport=10]="CsvExport",e[e.FirstPage=11]="FirstPage",e[e.PrevPage=12]="PrevPage",e[e.LastPage=13]="LastPage",e[e.NextPage=14]="NextPage",e[e.AddRow=15]="AddRow"}(e.ContextMenuItems||(e.ContextMenuItems={}));var te=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),re=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ie=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return te(r,e),re([t.Property(12)],r.prototype,"pageSize",void 0),re([t.Property(8)],r.prototype,"pageCount",void 0),re([t.Property(1)],r.prototype,"currentPage",void 0),re([t.Property()],r.prototype,"totalRecordsCount",void 0),re([t.Property(!1)],r.prototype,"enableQueryString",void 0),re([t.Property(!1)],r.prototype,"pageSizes",void 0),re([t.Property(null)],r.prototype,"template",void 0),re([t.Property("All")],r.prototype,"pageSizeMode",void 0),r}(t.ChildProperty),ne=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),oe=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ae=function(e){function i(){var r=null!==e&&e.apply(this,arguments)||this;return r.intl=new t.Internationalization,r.templateFn={},r}return ne(i,e),i.prototype.setFormatter=function(e){this.format&&(this.format.skeleton||this.format.format)&&(this.formatFn=this.getFormatFunction(this.format))},i.prototype.getFormatFunction=function(e){return e.type?this.intl.getDateFormat(e):this.intl.getNumberFormat(e)},i.prototype.getFormatter=function(){return this.formatFn},i.prototype.setTemplate=function(e){void 0===e&&(e={}),void 0!==this.footerTemplate&&(this.templateFn[t.getEnumValue(r.CellType,r.CellType.Summary)]={fn:t.compile(this.footerTemplate,e),property:"footerTemplate"})},i.prototype.getTemplate=function(e){return this.templateFn[t.getEnumValue(r.CellType,e)]},i.prototype.setPropertiesSilent=function(e){this.setProperties(e,!0)},oe([t.Property()],i.prototype,"type",void 0),oe([t.Property()],i.prototype,"footerTemplate",void 0),oe([t.Property()],i.prototype,"field",void 0),oe([t.Property()],i.prototype,"format",void 0),oe([t.Property()],i.prototype,"columnName",void 0),oe([t.Property()],i.prototype,"customAggregate",void 0),i}(t.ChildProperty),se=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return ne(r,e),oe([t.Collection([],ae)],r.prototype,"columns",void 0),oe([t.Property(!0)],r.prototype,"showChildSummary",void 0),r}(t.ChildProperty),le=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),de=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},pe=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return le(r,e),de([t.Property(!1)],r.prototype,"allowAdding",void 0),de([t.Property(!1)],r.prototype,"allowEditing",void 0),de([t.Property(!1)],r.prototype,"allowDeleting",void 0),de([t.Property("Row")],r.prototype,"mode",void 0),de([t.Property("Top")],r.prototype,"newRowPosition",void 0),de([t.Property(!0)],r.prototype,"allowEditOnDblClick",void 0),de([t.Property(!0)],r.prototype,"showConfirmDialog",void 0),de([t.Property(!1)],r.prototype,"showDeleteConfirmDialog",void 0),de([t.Property("")],r.prototype,"template",void 0),r}(t.ChildProperty),he=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ce=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ue=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return he(r,e),ce([t.Property()],r.prototype,"field",void 0),ce([t.Property()],r.prototype,"direction",void 0),r}(t.ChildProperty),ge=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return he(r,e),ce([t.Collection([],ue)],r.prototype,"columns",void 0),ce([t.Property(!0)],r.prototype,"allowUnsort",void 0),r}(t.ChildProperty),fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),ye=function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},me=function(a){function s(e,t){var i=a.call(this,e,t)||this;return i.dataResults={},i.grid=new r.Grid,i}return fe(s,a),s.prototype.excelExport=function(e,t,r,i){return this.excelExportModule.Map(e,t,r,i,!1)},s.prototype.csvExport=function(e,t,r,i){return this.excelExportModule.Map(e,t,r,i,!0)},s.prototype.pdfExport=function(e,t,r,i){return this.pdfExportModule.Map(e,t,r,i)},s.prototype.getModuleName=function(){return"treegrid"},s.prototype.preRender=function(){this.TreeGridLocale(),this.initProperties(),this.defaultLocale={Above:"Above",Below:"Below",AddRow:"AddRow",ExpandAll:"Expand All",CollapseAll:"Collapse All"},this.isSelfReference&&t.isNullOrUndefined(this.childMapping)&&(this.childMapping="Children")},s.prototype.sortByColumn=function(e,t,r){this.sortModule.sortColumn(e,t,r)},s.prototype.clearSorting=function(){this.sortModule.clearSorting()},s.prototype.removeSortColumn=function(e){this.sortModule.removeSortColumn(e)},s.prototype.search=function(e){this.grid.search(e)},s.prototype.autoFitColumns=function(e){this.resizeModule.autoFitColumns(e),this.updateColumnModel()},s.prototype.reorderColumns=function(e,t){this.grid.reorderColumns(e,t)},s.prototype.TreeGridLocale=function(){var e,i=t.L10n.locale;e={},t.setValue(this.locale,{},e);var n;n={},n=r.getObject(this.locale,i);var o;o={},o=r.getObject(this.getModuleName(),n),t.setValue("grid",o,r.getObject(this.locale,e)),t.L10n.load(e)},s.prototype.print=function(){this.printModule.print()},s.prototype.treeGridkeyActionHandler=function(e){if(this.allowKeyboard)switch(e.action){case"ctrlDownArrow":this.expandAll();break;case"ctrlUpArrow":this.collapseAll();break;case"ctrlShiftUpArrow":var r=e.target;this.expandCollapseRequest(r.querySelector(".e-icons"));break;case"ctrlShiftDownArrow":var i=e.target;this.expandCollapseRequest(i.querySelector(".e-icons"));break;case"downArrow":var n=e.target.parentElement,o=this.findnextRowElement(n);if(null!==o){var a=o.rowIndex;this.selectRow(a);var s=e.target.cellIndex,l=o.children[s];t.addClass([l],"e-focused"),t.addClass([l],"e-focus")}else this.clearSelection();break;case"upArrow":var d=e.target.parentElement,p=this.findPreviousRowElement(d);if(null!==p){var h=p.rowIndex;this.selectRow(h);var c=e.target.cellIndex,u=p.children[c];t.addClass([u],"e-focused"),t.addClass([u],"e-focus")}else this.clearSelection()}},s.prototype.findnextRowElement=function(e){var t=e.nextSibling;return null===t||-1===t.className.indexOf("e-summaryrow")&&"none"!==t.style.display||(t=this.findnextRowElement(t)),t},s.prototype.findPreviousRowElement=function(e){var t=e.previousSibling;return null===t||-1===t.className.indexOf("e-summaryrow")&&"none"!==t.style.display||(t=this.findPreviousRowElement(t)),t},s.prototype.initProperties=function(){this.defaultLocale={},this.flatData=[],this.parentData=[],this.columnModel=[],this.isExpandAll=!1,this.keyConfigs={ctrlDownArrow:"ctrl+downarrow",ctrlUpArrow:"ctrl+uparrow",ctrlShiftUpArrow:"ctrl+shift+uparrow",ctrlShiftDownArrow:"ctrl+shift+downarrow",downArrow:"downArrow",upArrow:"upArrow"},this.isLocalData=!(this.dataSource instanceof i.DataManager)||this.dataSource.dataSource.offline||!t.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof i.RemoteSaveAdaptor,this.isSelfReference=!t.isNullOrUndefined(this.parentIdMapping)},s.prototype.wireEvents=function(){t.EventHandler.add(this.element,"click",this.mouseClickHandler,this),t.EventHandler.add(this.element,"touchend",this.mouseClickHandler,this),this.keyboardModule=new t.KeyboardEvents(this.element,{keyAction:this.treeGridkeyActionHandler.bind(this),keyConfigs:this.keyConfigs,eventName:"keydown"}),this.allowKeyboard&&(this.element.tabIndex=-1===this.element.tabIndex?0:this.element.tabIndex)},s.prototype.requiredModules=function(){var e=[];return this.isDestroyed?e:(t.isNullOrUndefined(this.toolbar)||e.push({member:"toolbar",args:[this]}),this.contextMenuItems&&e.push({member:"contextMenu",args:[this]}),this.allowPaging&&e.push({member:"pager",args:[this,this.pageSettings]}),this.allowReordering&&e.push({member:"reorder",args:[this]}),this.allowSorting&&e.push({member:"sort",args:[this]}),this.aggregates.length>0&&e.push({member:"summary",args:[this]}),this.allowResizing&&e.push({member:"resize",args:[this]}),(this.allowFiltering||this.toolbar&&-1!==this.toolbar.indexOf("Search"))&&e.push({member:"filter",args:[this,this.filterSettings]}),this.allowExcelExport&&e.push({member:"ExcelExport",args:[this]}),this.allowPdfExport&&e.push({member:"PdfExport",args:[this]}),this.showColumnMenu&&e.push({member:"columnMenu",args:[this]}),(this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing)&&e.push({member:"edit",args:[this]}),this.isCommandColumn(this.columns)&&e.push({member:"commandColumn",args:[this]}),e)},s.prototype.isCommandColumn=function(e){var t=this;return e.some(function(e){return e.columns?t.isCommandColumn(e.columns):!(!e.commands&&!e.commandsTemplate)})},s.prototype.unwireEvents=function(){t.EventHandler.remove(this.element,"click",this.mouseClickHandler)},s.prototype.render=function(){n.createSpinner({target:this.element},this.createElement),this.renderModule=new Z(this),this.dataModule=new ee(this),this.printModule=new G(this),this.columnMenuModule=new y(this),this.trigger("load"),this.autoGenerateColumns(),this.convertTreeData(this.dataSource),this.loadGrid(),this.addListener();var e=t.createElement("div",{id:this.element.id+"_gridcontrol"});t.addClass([this.element],"e-treegrid"),this.element.appendChild(e),this.grid.appendTo(e),this.wireEvents()},s.prototype.convertTreeData=function(e){e instanceof Array&&e.length>0&&e[0].hasOwnProperty("level")?this.flatData=e:this.dataModule.convertToFlatData(e)},s.prototype.bindGridProperties=function(){this.grid.dataSource=o(this)?this.dataSource:this.flatData,this.grid.enableRtl=this.enableRtl,this.grid.columns=this.getGridColumns(),this.grid.allowExcelExport=this.allowExcelExport,this.grid.allowPdfExport=this.allowPdfExport,this.grid.query=this.query,this.grid.columnQueryMode=this.columnQueryMode,this.grid.allowPaging=this.allowPaging,this.grid.pageSettings=r.getActualProperties(this.pageSettings),this.grid.pagerTemplate=this.pagerTemplate,this.grid.showColumnMenu=this.showColumnMenu,this.grid.allowSorting=this.allowSorting,this.grid.allowFiltering=this.allowFiltering,this.grid.width=this.width,this.grid.height=this.height,this.grid.enableAltRow=this.enableAltRow,this.grid.allowReordering=this.allowReordering,this.grid.allowTextWrap=this.allowTextWrap,this.grid.allowResizing=this.allowResizing,this.grid.enableHover=this.enableHover,this.grid.rowHeight=this.rowHeight,this.grid.gridLines=this.gridLines,this.grid.allowSelection=this.allowSelection,this.grid.toolbar=r.getActualProperties(this.getGridToolbar()),this.grid.toolbarTemplate=this.toolbarTemplate,this.grid.filterSettings=r.getActualProperties(this.filterSettings),this.grid.selectionSettings=r.getActualProperties(this.selectionSettings),this.grid.sortSettings=r.getActualProperties(this.sortSettings),this.grid.searchSettings=r.getActualProperties(this.searchSettings),this.grid.aggregates=r.getActualProperties(this.aggregates),this.grid.textWrapSettings=r.getActualProperties(this.textWrapSettings),this.grid.printMode=r.getActualProperties(this.printMode),this.grid.locale=r.getActualProperties(this.locale),this.grid.contextMenuItems=r.getActualProperties(this.getContextMenu()),this.grid.editSettings=this.getGridEditSettings()},s.prototype.triggerEvents=function(e){this.trigger(r.getObject("name",e),e)},s.prototype.bindGridEvents=function(){var e=this,n=this;this.grid.rowSelecting=this.triggerEvents.bind(this),this.grid.rowSelected=function(t){e.selectedRowIndex=e.grid.selectedRowIndex,e.trigger(b,t)},this.grid.rowDeselected=function(t){e.selectedRowIndex=e.grid.selectedRowIndex,e.trigger(R,t)},this.grid.toolbarClick=function(t){t.item.id===e.grid.element.id+"_expandall"?e.expandAll():t.item.id===e.grid.element.id+"_collapseall"&&e.collapseAll(),e.trigger(S,t)},this.grid.resizeStop=function(t){e.updateColumnModel(),e.trigger(E,t)},this.grid.excelQueryCellInfo=function(t){e.notify("excelCellInfo",t),t=e.dataResults},this.grid.pdfQueryCellInfo=function(t){e.notify("pdfCellInfo",t),t=e.dataResults},this.grid.pdfExportComplete=this.triggerEvents.bind(this),this.grid.excelExportComplete=this.triggerEvents.bind(this),this.grid.excelHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.pdfHeaderQueryCellInfo=this.triggerEvents.bind(this),this.grid.dataSourceChanged=this.triggerEvents.bind(this),this.grid.dataStateChange=this.triggerEvents.bind(this),this.grid.recordDoubleClick=this.triggerEvents.bind(this),this.grid.rowDeselecting=this.triggerEvents.bind(this),this.grid.cellDeselected=this.triggerEvents.bind(this),this.grid.cellSelecting=this.triggerEvents.bind(this),this.grid.cellDeselecting=this.triggerEvents.bind(this),this.grid.cellSelected=this.triggerEvents.bind(this),this.grid.headerCellInfo=this.triggerEvents.bind(this),this.grid.resizeStart=this.triggerEvents.bind(this),this.grid.resizing=this.triggerEvents.bind(this),this.grid.columnDrag=this.triggerEvents.bind(this),this.grid.columnDragStart=this.triggerEvents.bind(this),this.grid.columnDrop=this.triggerEvents.bind(this),this.grid.beforePrint=this.triggerEvents.bind(this),this.grid.printComplete=this.triggerEvents.bind(this),this.grid.beginEdit=this.triggerEvents.bind(this),this.grid.cellEdit=this.triggerEvents.bind(this),this.grid.actionFailure=this.triggerEvents.bind(this),this.grid.dataBound=function(i){if(e.updateColumnModel(),e.trigger("dataBound",i),o(e)&&!d(e)&&!e.hasChildMapping){var n=r.getObject("dataSource.requests",e).filter(function(e){return"OK"!==e.httpRequest.statusText}).length;t.setValue("grid.contentModule.isLoaded",!(n>0),e)}e.initialRender=!1},this.grid.beforeDataBound=function(e){if(o(n)&&!d(n))e.result=n.dataModule.updateParentRemoteData(e.result);else if(0===n.flatData.length&&d(n)&&n.dataSource instanceof i.DataManager){var r=n.dataSource;n.dataModule.convertToFlatData(r.dataSource.json),e.result=n.flatData}o(n)||n.notify("dataProcessor",e),t.extend(e,n.dataResults),this.isPrinting||n.trigger(w,e)},this.extendedGridEvents(),this.extendedGridEditEvents()},s.prototype.extendedGridEditEvents=function(){var e=this;this.grid.cellSave=function(t){e.trigger(B,t),t.cancel||e.notify(B,t)},this.grid.cellEdit=function(t){e.trigger(_,t),e.notify(_,t)},this.grid.batchCancel=function(t){"Cell"!==e.editSettings.mode&&e.trigger(V,t),e.notify(V,t)}},s.prototype.extendedGridEvents=function(){var e=this,i=this;this.grid.recordDoubleClick=function(t){e.trigger(q,t),e.notify(q,t)},this.grid.actionBegin=function(t){"reorder"===r.getObject("requestType",t)&&e.notify("getColumnIndex",{}),!o(e)&&e.grid.allowFiltering&&0===e.grid.filterSettings.columns.length&&(e.notify("clearFilters",{flatData:e.flatData}),e.grid.dataSource=e.dataResults.result),e.trigger(x,t),e.notify(F,t)},this.grid.actionComplete=function(t){e.updateColumnModel(),"reorder"===t.requestType&&e.notify("setColumnIndex",{}),e.isLocalData&&("delete"!==t.requestType&&"save"!==t.requestType||("save"===t.requestType&&"Cell"===e.editSettings.mode&&(t.column=e.getColumnByField(e.cellEditedColumn)),e.notify(L,{value:t.data,action:t.action||t.requestType})),"add"===t.requestType&&"Top"!==e.editSettings.newRowPosition&&"Bottom"!==e.editSettings.newRowPosition&&e.notify(U,t),"batchsave"===t.requestType&&e.notify("batchSave",t)),e.trigger(C,t)},this.grid.rowDataBound=function(e){t.isNullOrUndefined(this.isPrinting)?t.setValue("isPrinting",!1,e):t.setValue("isPrinting",this.isPrinting,e),i.renderModule.RowModifier(e)},this.grid.queryCellInfo=function(e){t.isNullOrUndefined(this.isPrinting)?t.setValue("isPrinting",!1,e):t.setValue("isPrinting",this.isPrinting,e),i.renderModule.cellRender(e)},this.grid.contextMenuClick=this.triggerEvents.bind(this),this.grid.contextMenuOpen=function(t){e.notify(T,t),e.trigger(T,t)},this.grid.queryCellInfo=function(t){e.renderModule.cellRender(t)}},s.prototype.loadGrid=function(){this.bindGridProperties(),this.bindGridEvents(),t.setValue("registeredTemplate",this.registeredTemplate,this.grid)},s.prototype.autoGenerateColumns=function(){if(!this.columns.length&&!this.dataModule.isRemote()&&Object.keys(this.dataSource).length){var e=void 0;e=this.dataSource[0];for(var t=Object.keys(e),r=0;r<t.length;r++)-1===[this.childMapping,this.parentIdMapping].indexOf(t[r])&&this.columns.push(t[r])}},s.prototype.getGridEditSettings=function(){var e={};switch(e.allowAdding=this.editSettings.allowAdding,e.allowEditing=this.editSettings.allowEditing,e.allowDeleting=this.editSettings.allowDeleting,e.newRowPosition="Bottom"===this.editSettings.newRowPosition?"Bottom":"Top",e.allowEditOnDblClick=this.editSettings.allowEditOnDblClick,e.showConfirmDialog=this.editSettings.showConfirmDialog,e.template=this.editSettings.template,e.showDeleteConfirmDialog=this.editSettings.showDeleteConfirmDialog,this.editSettings.mode){case"Dialog":e.mode=this.editSettings.mode;break;case"Row":e.mode="Normal";break;case"Cell":e.mode="Normal",e.showConfirmDialog=!1}return e},s.prototype.getContextMenu=function(){if(this.contextMenuItems){for(var t=[],r=0;r<this.contextMenuItems.length;r++)switch(this.contextMenuItems[r]){case"AddRow":case e.ContextMenuItems.AddRow:t.push({text:"AddRow",target:".e-content",id:this.element.id+"_gridcontrol_cmenu_AddRow",items:[{text:"Above",id:"Above"},{text:"Below",id:"Below"}]});break;default:t.push(this.contextMenuItems[r])}return t}return null},s.prototype.getGridToolbar=function(){if(this.toolbar){this.l10n=new t.L10n("treegrid",this.defaultLocale,this.locale);for(var r=[],i=0;i<this.toolbar.length;i++)switch(this.toolbar[i]){case"Search":case e.ToolbarItem.Search:r.push("Search");break;case"Print":case e.ToolbarItem.Print:r.push("Print");break;case"ExpandAll":case e.ToolbarItem.ExpandAll:var n=this.l10n.getConstant("ExpandAll");r.push({text:n,tooltipText:n,prefixIcon:"e-expand",id:this.element.id+"_gridcontrol_expandall"});break;case"CollapseAll":case e.ToolbarItem.CollapseAll:var o=this.l10n.getConstant("CollapseAll");r.push({text:o,tooltipText:o,prefixIcon:"e-collapse",id:this.element.id+"_gridcontrol_collapseall"});break;default:r.push(this.toolbar[i])}return r}return null},s.prototype.getGridColumns=function(){var e=this.columns;this.columnModel=[];for(var t,r,i=[],n=0;n<e.length;n++){if(r={},t={},"string"==typeof this.columns[n])r.field=t.field=this.columns[n];else for(var o=0,a=Object.keys(e[n]);o<a.length;o++){var s=a[o];r[s]=t[s]=e[n][s]}this.columnModel.push(new c(t)),i.push(r)}return i},s.prototype.onPropertyChanged=function(e,n){for(var o=!1,a=0,s=Object.keys(e);a<s.length;a++){var l=s[a];switch(l){case"columns":this.grid.columns=this.getGridColumns();break;case"treeColumnIndex":this.grid.refreshColumns();break;case"allowPaging":this.grid.allowPaging=this.allowPaging;break;case"pageSettings":this.grid.pageSettings=r.getActualProperties(this.pageSettings),o=!0;break;case"toolbar":this.grid.toolbar=this.getGridToolbar();break;case"allowSelection":this.grid.allowSelection=this.allowSelection;break;case"selectionSettings":this.grid.selectionSettings=r.getActualProperties(this.selectionSettings);break;case"allowSorting":this.grid.allowSorting=this.allowSorting;break;case"allowMultiSorting":this.grid.allowMultiSorting=this.allowMultiSorting;break;case"sortSettings":this.grid.sortSettings=r.getActualProperties(this.sortSettings);break;case"searchSettings":this.grid.searchSettings=r.getActualProperties(this.searchSettings);break;case"allowFiltering":this.grid.allowFiltering=this.allowFiltering;break;case"filterSettings":this.grid.filterSettings=r.getActualProperties(this.filterSettings);break;case"showColumnMenu":this.grid.showColumnMenu=this.showColumnMenu;break;case"aggregates":this.grid.aggregates=r.getActualProperties(this.aggregates);break;case"dataSource":this.isLocalData=!(this.dataSource instanceof i.DataManager)||!t.isNullOrUndefined(this.dataSource.ready)||this.dataSource.adaptor instanceof i.RemoteSaveAdaptor,this.convertTreeData(this.dataSource),this.grid.dataSource=this.flatData.slice();break;case"enableCollapseAll":e[l]?this.collapseAll():this.expandAll();break;case"expandStateMapping":this.refresh();break;case"gridLines":this.grid.gridLines=this.gridLines;break;case"rowHeight":this.grid.rowHeight=this.rowHeight;break;case"enableAltRow":this.grid.enableAltRow=this.enableAltRow;break;case"enableHover":this.grid.enableHover=this.enableHover;break;case"allowExcelExport":this.grid.allowExcelExport=this.allowExcelExport;break;case"allowPdfExport":this.grid.allowPdfExport=this.allowPdfExport;break;case"enableRtl":this.grid.enableRtl=this.enableRtl;break;case"allowReordering":this.grid.allowReordering=this.allowReordering;break;case"allowResizing":this.grid.allowResizing=this.allowResizing;break;case"textWrapSettings":this.grid.textWrapSettings=r.getActualProperties(this.textWrapSettings);break;case"allowTextWrap":this.grid.allowTextWrap=r.getActualProperties(this.allowTextWrap);break;case"contextMenuItems":this.grid.contextMenuItems=this.getContextMenu();break;case"editSettings":this.grid.isEdit&&"Normal"===this.grid.editSettings.mode&&e[l].mode&&("Cell"===e[l].mode||"Row"===e[l].mode)&&this.grid.closeEdit(),this.grid.editSettings=this.getGridEditSettings()}o&&this.refresh()}},s.prototype.destroy=function(){this.removeListener(),this.unwireEvents(),a.prototype.destroy.call(this),this.grid.destroy(),this.dataModule.destroy();for(var e=["dataModule","sortModule","renderModule","filterModule","printModule","excelExportModule","pdfExportModule","toolbarModule","summaryModule","reorderModule","resizeModule","pagerModule","keyboardModule","columnMenuModule","contextMenuModule","editModule"],t=0;t<e.length;t++)this[e[t]]&&(this[e[t]]=null);this.element.innerHTML="",this.grid=null},s.prototype.dataBind=function(){a.prototype.dataBind.call(this),this.grid.dataBind()},s.prototype.getPersistData=function(){var e=this,t=["pageSettings","sortSettings","filterSettings","columns","searchSettings","selectedRowIndex"],r={pageSettings:["template","pageSizes","pageSizeMode","enableQueryString","totalRecordsCount","pageCount"],filterSettings:["type","mode","showFilterBarStatus","immediateModeDelay","ignoreAccent","hierarchyMode"],searchSettings:["fields","operator","ignoreCase"],sortSettings:[],columns:[],selectedRowIndex:[]};return t.forEach(function(t){for(var i=e[t],n=0,o=r[t];n<o.length;n++){delete i[o[n]]}}),this.ignoreInArrays(["filter","edit","filterBarTemplate","headerTemplate","template","commandTemplate","commands","dataSource"],this.columns),this.addOnPersist(t)},s.prototype.ignoreInArrays=function(e,t){var r=this;t.forEach(function(t){t.columns?(r.ignoreInColumn(e,t),r.ignoreInArrays(e,t.columns)):r.ignoreInColumn(e,t)})},s.prototype.ignoreInColumn=function(e,t){e.forEach(function(e){delete t[e],t.filter={}})},s.prototype.mouseClickHandler=function(e){if(t.isNullOrUndefined(e.touches)){var r=e.target;(r.classList.contains("e-treegridexpand")||r.classList.contains("e-treegridcollapse"))&&this.expandCollapseRequest(r)}},s.prototype.getRows=function(){return this.grid.getRows()},s.prototype.getPager=function(){return this.grid.getPager()},s.prototype.addRecord=function(e,t){this.grid.editModule.addRecord(e,t)},s.prototype.closeEdit=function(){this.grid.editModule.closeEdit()},s.prototype.deleteRecord=function(e,t){this.grid.editModule.deleteRecord(e,t)},s.prototype.startEdit=function(){this.grid.editModule.startEdit()},s.prototype.endEdit=function(){this.grid.editModule.endEdit()},s.prototype.deleteRow=function(e){this.grid.editModule.deleteRow(e)},s.prototype.getPrimaryKeyFieldNames=function(){return this.grid.getPrimaryKeyFieldNames()},s.prototype.setCellValue=function(e,t,r){this.grid.setCellValue(e,t,r)},s.prototype.setRowData=function(e,t){this.grid.setRowData(e,t)},s.prototype.goToPage=function(e){this.grid.pagerModule.goToPage(e)},s.prototype.getCellFromIndex=function(e,t){return this.grid.getCellFromIndex(e,t)},s.prototype.getColumnByField=function(e){return r.iterateArrayOrObject(this.columnModel,function(t,r){if(t.field===e)return t})[0]},s.prototype.getColumnByUid=function(e){return r.iterateArrayOrObject(this.columnModel,function(t,r){if(t.uid===e)return t})[0]},s.prototype.getColumnFieldNames=function(){return this.grid.getColumnFieldNames()},s.prototype.getFooterContent=function(){return this.grid.getFooterContent()},s.prototype.getFooterContentTable=function(){return this.grid.getFooterContentTable()},s.prototype.showColumns=function(e,t){return this.grid.showColumns(e,t)},s.prototype.hideColumns=function(e,t){return this.grid.hideColumns(e,t)},s.prototype.getColumnHeaderByField=function(e){return this.grid.getColumnHeaderByField(e)},s.prototype.getColumnHeaderByIndex=function(e){return this.grid.getColumnHeaderByIndex(e)},s.prototype.getColumnHeaderByUid=function(e){return this.grid.getColumnHeaderByUid(e)},s.prototype.getColumnIndexByField=function(e){return this.grid.getColumnIndexByField(e)},s.prototype.getColumnIndexByUid=function(e){return this.grid.getColumnIndexByUid(e)},s.prototype.getColumns=function(e){return this.updateColumnModel(this.grid.getColumns(e)),this.columnModel},s.prototype.updateColumnModel=function(e){var r,i=t.isNullOrUndefined(e)?this.grid.getColumns():e;this.columnModel=[];for(var n=0;n<i.length;n++){r={};for(var o=0,a=Object.keys(i[n]);o<a.length;o++){var s=a[o];r[s]=i[n][s]}this.columnModel.push(new c(r))}return this.setProperties({columns:this.columnModel},!0),this.columnModel},s.prototype.getContent=function(){return this.grid.getContent()},s.prototype.getContentTable=function(){return this.grid.getContentTable()},s.prototype.getDataRows=function(){for(var e=[],t=this.grid.getDataRows(),r=0,i=t.length;r<i;r++)t[r].classList.contains("e-summaryrow")||e.push(t[r]);return e},s.prototype.getCurrentViewRecords=function(){return this.grid.currentViewData},s.prototype.getHeaderContent=function(){return this.grid.getHeaderContent()},s.prototype.getHeaderTable=function(){return this.grid.getHeaderTable()},s.prototype.getRowByIndex=function(e){return this.grid.getRowByIndex(e)},s.prototype.getRowInfo=function(e){return this.grid.getRowInfo(e)},s.prototype.getUidByColumnField=function(e){return this.grid.getUidByColumnField(e)},s.prototype.getVisibleColumns=function(){for(var e=[],t=0,r=this.columnModel;t<r.length;t++){var i=r[t];i.visible&&e.push(i)}return e},s.prototype.showSpinner=function(){n.showSpinner(this.element)},s.prototype.hideSpinner=function(){n.hideSpinner(this.element)},s.prototype.refresh=function(){this.grid.refresh()},s.prototype.refreshColumns=function(){this.grid.columns=this.getGridColumns(),this.grid.refreshColumns()},s.prototype.refreshHeader=function(){this.grid.refreshHeader()},s.prototype.expandCollapseRequest=function(e){var t=this.grid.getRowInfo(e),r=t.rowData;e.classList.contains("e-treegridexpand")?this.collapseRow(t.row,r):this.expandRow(t.row,r)},s.prototype.expandRow=function(e,t){var r={data:t=this.getCollapseExpandRecords(e,t),row:e,cancel:!1};if(this.trigger("expanding",r),!r.cancel&&(this.expandCollapse("expand",e,t),!o(this)||d(this))){var i={data:t,row:e};this.trigger(I,i)}},s.prototype.getCollapseExpandRecords=function(e,r){return this.allowPaging&&"All"===this.pageSettings.pageSizeMode&&this.isExpandAll&&t.isNullOrUndefined(r)?r=this.flatData.filter(function(e){return e.hasChildRecords}):t.isNullOrUndefined(r)&&(r=this.grid.getCurrentViewRecords()[e.rowIndex]),r},s.prototype.collapseRow=function(e,t){var r={data:t=this.getCollapseExpandRecords(e,t),row:e,cancel:!1};if(this.trigger(D,r),!r.cancel){this.expandCollapse("collapse",e,t);var i={data:t,row:e};this.trigger(O,i)}},s.prototype.expandAtLevel=function(e){if(this.allowPaging&&"All"===this.pageSettings.pageSizeMode){var t=this.flatData.filter(function(t){return t.hasChildRecords&&t.level===e&&(t.expanded=!0),t.hasChildRecords&&t.level===e});this.expandRow(null,t)}else{t=this.getRecordDetails(e);for(var i=r.getObject("rows",t),n=r.getObject("records",t),o=0;o<n.length;o++)this.expandRow(i[o],n[o])}},s.prototype.getRecordDetails=function(e){var t=this.getRows().filter(function(t){return-1!==t.className.indexOf("level"+e)&&(t.querySelector(".e-treegridcollapse")||t.querySelector(".e-treegridexpand"))});return{records:this.getCurrentViewRecords().filter(function(t){return t.level===e&&t.hasChildRecords}),rows:t}},s.prototype.collapseAtLevel=function(e){if(this.allowPaging&&"All"===this.pageSettings.pageSizeMode){var t=this.flatData.filter(function(t){return t.hasChildRecords&&t.level===e&&(t.expanded=!1),t.hasChildRecords&&t.level===e});this.collapseRow(null,t)}else{t=this.getRecordDetails(e);for(var i=r.getObject("rows",t),n=r.getObject("records",t),o=0;o<n.length;o++)this.collapseRow(i[o],n[o])}},s.prototype.expandAll=function(){this.expandCollapseAll("expand")},s.prototype.collapseAll=function(){this.expandCollapseAll("collapse")},s.prototype.expandCollapseAll=function(e){var t=this.getRows().filter(function(t){return t.querySelector(".e-treegrid"+("expand"===e?"collapse":"expand"))});if(this.isExpandAll=!0,this.allowPaging&&"All"===this.pageSettings.pageSizeMode)this.flatData.filter(function(t){t.hasChildRecords&&(t.expanded="collapse"!==e)}),"collapse"===e?this.collapseRow(t[0]):this.expandRow(t[0]);else for(var r=0;r<t.length;r++)"collapse"===e?this.collapseRow(t[r]):this.expandRow(t[r]);this.isExpandAll=!1},s.prototype.expandCollapse=function(e,r,i,n){var a=this.getRows();if(t.isNullOrUndefined(r)?r=a[i.index]:+r.getAttribute("aria-rowindex"),this.allowPaging&&"All"===this.pageSettings.pageSizeMode&&!o(this))this.notify(j,{action:e,row:r,record:i});else{var s=void 0;if("expand"===e){s="table-row",n||(i.expanded=!0);var l=r.getElementsByClassName("e-treegridcollapse")[0];if(t.isNullOrUndefined(l))return;t.addClass([l],"e-treegridexpand"),t.removeClass([l],"e-treegridcollapse")}else{s="none",n||(i.expanded=!1);l=r.getElementsByClassName("e-treegridexpand")[0];if(t.isNullOrUndefined(l))return;t.addClass([l],"e-treegridcollapse"),t.removeClass([l],"e-treegridexpand")}var p={data:i,row:r};if(o(this)&&!d(this)){var h=a.filter(function(e){return e.classList.contains("e-gridrowindex"+i.index+"level"+(i.level+1))});"expand"===e?this.notify(A,{record:i,rows:h,parentRow:r}):(this.collapseRemoteChild(h),this.trigger(O,p))}else for(var c=i.childRecords,u=(c[0].parentItem.index,h=a.filter(function(e){return e.classList.contains("e-gridrowindex"+i.index+"level"+(i.level+1))}),0);u<h.length;u++)h[u].style.display=s,t.isNullOrUndefined(c[u].childRecords)||"expand"===e&&!t.isNullOrUndefined(c[u].expanded)&&!c[u].expanded||this.expandCollapse(e,h[u],c[u],!0)}},s.prototype.collapseRemoteChild=function(e){for(var r=function(r){var n=i.grid.getRowObjectFromUID(e[r].getAttribute("data-Uid")).data;if(n.expanded=!1,e[r].style.display="none",e[r].querySelector(".e-treecolumn-container .e-treegridexpand")){t.removeClass([e[r].getElementsByClassName("e-icons")[0]],"e-treegridexpand"),t.addClass([e[r].getElementsByClassName("e-icons")[0]],"e-treegridcollapse");var o=i.getRows().filter(function(e){return e.classList.contains("e-gridrowindex"+n.index+"level"+(n.level+1))});i.collapseRemoteChild(o)}},i=this,n=0;n<e.length;n++)r(n)},s.prototype.addListener=function(){this.on("updateResults",this.updateResultModel,this)},s.prototype.updateResultModel=function(e){this.dataResults=e},s.prototype.removeListener=function(){this.isDestroyed||this.off("updateResults",this.updateResultModel)},s.prototype.filterByColumn=function(e,t,r,i,n,o,a,s){this.grid.filterByColumn(e,t,r,i,n,o,a,s)},s.prototype.clearFiltering=function(){this.grid.clearFiltering()},s.prototype.removeFilteredColsByField=function(e,t){this.grid.removeFilteredColsByField(e,t)},s.prototype.selectRow=function(e,t){this.grid.selectRow(e,t)},s.prototype.selectRows=function(e){this.grid.selectRows(e)},s.prototype.clearSelection=function(){this.grid.clearSelection()},s.prototype.selectCell=function(e,t){this.grid.selectCell(e,t)},s.prototype.getSelectedRows=function(){return this.grid.getSelectedRows()},s.prototype.getSelectedRowIndexes=function(){return this.grid.getSelectedRowIndexes()},s.prototype.getSelectedRowCellIndexes=function(){return this.grid.getSelectedRowCellIndexes()},s.prototype.getSelectedRecords=function(){return this.grid.getSelectedRecords()},s.prototype.getDataModule=function(){return{baseModule:this.grid.getDataModule(),treeModule:this.dataModule}},ye([t.Property([])],s.prototype,"columns",void 0),ye([t.Property(null)],s.prototype,"childMapping",void 0),ye([t.Property(null)],s.prototype,"hasChildMapping",void 0),ye([t.Property(0)],s.prototype,"treeColumnIndex",void 0),ye([t.Property(null)],s.prototype,"idMapping",void 0),ye([t.Property(null)],s.prototype,"parentIdMapping",void 0),ye([t.Property(!1)],s.prototype,"enableCollapseAll",void 0),ye([t.Property(null)],s.prototype,"expandStateMapping",void 0),ye([t.Property([])],s.prototype,"dataSource",void 0),ye([t.Property()],s.prototype,"query",void 0),ye([t.Property()],s.prototype,"cloneQuery",void 0),ye([t.Property("AllPages")],s.prototype,"printMode",void 0),ye([t.Property(!1)],s.prototype,"allowPaging",void 0),ye([t.Property(!1)],s.prototype,"allowTextWrap",void 0),ye([t.Complex({},r.TextWrapSettings)],s.prototype,"textWrapSettings",void 0),ye([t.Property(!1)],s.prototype,"allowReordering",void 0),ye([t.Property(!1)],s.prototype,"allowResizing",void 0),ye([t.Complex({},ie)],s.prototype,"pageSettings",void 0),ye([t.Property()],s.prototype,"pagerTemplate",void 0),ye([t.Property(!1)],s.prototype,"showColumnMenu",void 0),ye([t.Property(!1)],s.prototype,"allowSorting",void 0),ye([t.Property(!0)],s.prototype,"allowMultiSorting",void 0),ye([t.Complex({},ge)],s.prototype,"sortSettings",void 0),ye([t.Collection([],se)],s.prototype,"aggregates",void 0),ye([t.Complex({},pe)],s.prototype,"editSettings",void 0),ye([t.Property(!1)],s.prototype,"allowFiltering",void 0),ye([t.Complex({},f)],s.prototype,"filterSettings",void 0),ye([t.Complex({},K)],s.prototype,"searchSettings",void 0),ye([t.Property()],s.prototype,"toolbar",void 0),ye([t.Property()],s.prototype,"toolbarTemplate",void 0),ye([t.Property("Default")],s.prototype,"gridLines",void 0),ye([t.Property()],s.prototype,"contextMenuItems",void 0),ye([t.Property(null)],s.prototype,"rowHeight",void 0),ye([t.Property(!0)],s.prototype,"enableAltRow",void 0),ye([t.Property(!0)],s.prototype,"allowKeyboard",void 0),ye([t.Property(!0)],s.prototype,"enableHover",void 0),ye([t.Property("auto")],s.prototype,"height",void 0),ye([t.Property("auto")],s.prototype,"width",void 0),ye([t.Property("All")],s.prototype,"columnQueryMode",void 0),ye([t.Event()],s.prototype,"created",void 0),ye([t.Event()],s.prototype,"load",void 0),ye([t.Event()],s.prototype,"expanding",void 0),ye([t.Event()],s.prototype,"expanded",void 0),ye([t.Event()],s.prototype,"collapsing",void 0),ye([t.Event()],s.prototype,"collapsed",void 0),ye([t.Event()],s.prototype,"actionBegin",void 0),ye([t.Event()],s.prototype,"actionComplete",void 0),ye([t.Event()],s.prototype,"beginEdit",void 0),ye([t.Event()],s.prototype,"cellEdit",void 0),ye([t.Event()],s.prototype,"actionFailure",void 0),ye([t.Event()],s.prototype,"dataBound",void 0),ye([t.Event()],s.prototype,"dataSourceChanged",void 0),ye([t.Event()],s.prototype,"dataStateChange",void 0),ye([t.Event()],s.prototype,"recordDoubleClick",void 0),ye([t.Event()],s.prototype,"rowDataBound",void 0),ye([t.Event()],s.prototype,"queryCellInfo",void 0),ye([t.Property(!0)],s.prototype,"allowSelection",void 0),ye([t.Event()],s.prototype,"rowSelecting",void 0),ye([t.Event()],s.prototype,"rowSelected",void 0),ye([t.Event()],s.prototype,"rowDeselecting",void 0),ye([t.Event()],s.prototype,"rowDeselected",void 0),ye([t.Event()],s.prototype,"headerCellInfo",void 0),ye([t.Event()],s.prototype,"cellSelecting",void 0),ye([t.Event()],s.prototype,"cellSelected",void 0),ye([t.Event()],s.prototype,"cellDeselecting",void 0),ye([t.Event()],s.prototype,"cellDeselected",void 0),ye([t.Event()],s.prototype,"resizeStart",void 0),ye([t.Event()],s.prototype,"resizing",void 0),ye([t.Event()],s.prototype,"resizeStop",void 0),ye([t.Event()],s.prototype,"columnDragStart",void 0),ye([t.Event()],s.prototype,"columnDrag",void 0),ye([t.Event()],s.prototype,"columnDrop",void 0),ye([t.Event()],s.prototype,"printComplete",void 0),ye([t.Event()],s.prototype,"beforePrint",void 0),ye([t.Event()],s.prototype,"toolbarClick",void 0),ye([t.Event()],s.prototype,"beforeDataBound",void 0),ye([t.Event()],s.prototype,"contextMenuOpen",void 0),ye([t.Event()],s.prototype,"contextMenuClick",void 0),ye([t.Property(-1)],s.prototype,"selectedRowIndex",void 0),ye([t.Complex({},Y)],s.prototype,"selectionSettings",void 0),ye([t.Property(!1)],s.prototype,"allowExcelExport",void 0),ye([t.Property(!1)],s.prototype,"allowPdfExport",void 0),ye([t.Event()],s.prototype,"pdfQueryCellInfo",void 0),ye([t.Event()],s.prototype,"pdfHeaderQueryCellInfo",void 0),ye([t.Event()],s.prototype,"excelQueryCellInfo",void 0),ye([t.Event()],s.prototype,"excelHeaderQueryCellInfo",void 0),ye([t.Event()],s.prototype,"beforeExcelExport",void 0),ye([t.Event()],s.prototype,"excelExportComplete",void 0),ye([t.Event()],s.prototype,"beforePdfExport",void 0),ye([t.Event()],s.prototype,"pdfExportComplete",void 0),s=ye([t.NotifyPropertyChanges],s)}(t.Component),ve=function(){function e(e,t){r.Grid.Inject(r.Reorder),this.parent=e,this.treeColumn=t,this.addEventListener()}return e.prototype.getModuleName=function(){return"reorder"},e.prototype.addEventListener=function(){this.parent.on("getColumnIndex",this.getTreeColumn,this),this.parent.on("setColumnIndex",this.setTreeColumnIndex,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("getColumnIndex",this.getTreeColumn),this.parent.off("setColumnIndex",this.getTreeColumn))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getTreeColumn=function(){this.treeColumn=this.parent.columns[this.parent.treeColumnIndex]},e.prototype.setTreeColumnIndex=function(){for(var e,t=0;t<this.parent.columns.length;t++){r.getObject("field",this.treeColumn)===r.getObject("field",this.parent.columns[t])&&(e=t)}this.parent.treeColumnIndex=e},e}(),we=function(){function e(e){r.Grid.Inject(r.Resize),this.parent=e}return e.prototype.autoFitColumns=function(e){this.parent.grid.autoFitColumns(e)},e.prototype.getModuleName=function(){return"resize"},e.prototype.destroy=function(){this.parent.isDestroyed||this.parent.grid.resizeModule.destroy()},e}(),xe=function(){function e(e){r.Grid.Inject(r.Filter),this.parent=e,this.isHierarchyFilter=!1,this.filteredResult=[],this.flatFilteredData=[],this.filteredParentRecs=[],this.filterRootIndex=-1,this.addEventListener()}return e.prototype.getModuleName=function(){return"filter"},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.addEventListener=function(){this.parent.on("updateFilterRecs",this.updatedFilteredRecord,this),this.parent.on("clearFilters",this.clearFilterLevel,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateFilterRecs",this.updatedFilteredRecord),this.parent.off("clearFilters",this.clearFilterLevel))},e.prototype.updatedFilteredRecord=function(e){this.flatFilteredData=e.data,this.filteredParentRecs=[],this.filteredResult=[],this.isHierarchyFilter=!1;for(var i=function(e){var i=n.flatFilteredData[e];n.addParentRecord(i),"Child"!==n.parent.filterSettings.hierarchyMode&&"None"!==n.parent.filterSettings.hierarchyMode&&"Child"!==n.parent.searchSettings.hierarchyMode&&"None"!==n.parent.searchSettings.hierarchyMode||(n.isHierarchyFilter=!0);var o=r.getObject("childRecords",i);!t.isNullOrUndefined(o)&&o.length&&t.setValue("hasFilteredChildRecords",n.checkChildExsist(i),i);var a=r.getObject("parentItem",i);if(!t.isNullOrUndefined(a)){var s=n.flatFilteredData.filter(function(e){return e.uniqueID===i.parentItem.uniqueID})[0];t.setValue("hasFilteredChildRecords",!0,s)}},n=this,o=0;o<this.flatFilteredData.length;o++)i(o);this.flatFilteredData.length>0&&this.isHierarchyFilter&&this.updateFilterLevel(),this.parent.notify("updateAction",{result:this.filteredResult})},e.prototype.addParentRecord=function(e){var r=this.parent.flatData.filter(function(t){return t.uniqueID===e.parentUniqueID})[0];if("None"===this.parent.filterSettings.hierarchyMode||"None"===this.parent.searchSettings.hierarchyMode)if(t.isNullOrUndefined(r)){if(-1!==this.flatFilteredData.indexOf(e))return void(-1===this.filteredResult.indexOf(e)&&(this.filteredResult.push(e),e.hasFilteredChildRecords=!0))}else this.addParentRecord(r),-1!==this.flatFilteredData.indexOf(r)||-1!==this.filteredResult.indexOf(r)?-1===this.filteredResult.indexOf(e)&&this.filteredResult.push(e):-1===this.filteredResult.indexOf(e)&&-1!==this.flatFilteredData.indexOf(e)&&this.filteredResult.push(e);else t.isNullOrUndefined(r)||("Child"===this.parent.filterSettings.hierarchyMode||"Child"===this.parent.searchSettings.hierarchyMode?-1!==this.flatFilteredData.indexOf(r)&&this.addParentRecord(r):this.addParentRecord(r)),-1===this.filteredResult.indexOf(e)&&this.filteredResult.push(e)},e.prototype.checkChildExsist=function(e){for(var i=r.getObject("childRecords",e),n=!1,o=0;o<i.length;o++){var a=r.getObject("childRecords",i[o]);if("Child"!==this.parent.filterSettings.hierarchyMode&&"Both"!==this.parent.filterSettings.hierarchyMode&&"Child"!==this.parent.searchSettings.hierarchyMode&&"Both"!==this.parent.searchSettings.hierarchyMode||(this.filteredResult.push(i[o]),n=!0),("None"===this.parent.filterSettings.hierarchyMode||"None"===this.parent.searchSettings.hierarchyMode)&&this.flatFilteredData.indexOf(-1!==i[o])){n=!0;break}!t.isNullOrUndefined(a)&&a.length&&(n=this.checkChildExsist(i[o]))}return n},e.prototype.updateFilterLevel=function(){for(var e=this.filteredResult,r=this.filteredResult.length,i=function(r){var i=n.parent.flatData.filter(function(t){return t.uniqueID===e[r].parentUniqueID})[0];if(-1!==e.indexOf(i)){var o=n.filteredResult.filter(function(t){return t.uniqueID===e[r].parentUniqueID})[0];t.setValue("filterLevel",o.filterLevel+1,e[r]),e[r].filterRootIndex=n.filterRootIndex}else t.setValue("filterLevel",0,e[r]),n.filterRootIndex=e[r].filterIndex=r,e[r].filterIndex=n.filterRootIndex,n.filteredParentRecs.push(e[r])},n=this,o=0;o<r;o++)i(o)},e.prototype.clearFilterLevel=function(e){for(var i,n=0,o=e.flatData,a=o.length;n<a;n++){i=o[n];var s=r.getObject("filterLevel",i);if(s||0===s){var l=r.getObject("childRecords",i);!t.isNullOrUndefined(l)&&l.length&&t.setValue("hasFilteredChildRecords",!0,i),t.setValue("filterLevel",null,i),t.setValue("filterIndex",null,i),t.setValue("filterRootIndex",null,i)}}this.parent.notify("updateResults",{result:o,count:o.length})},e}(),Ce=function(){function e(e){r.Grid.Inject(r.ExcelExport),this.parent=e,this.dataResults={},this.addEventListener()}return e.prototype.getModuleName=function(){return"ExcelExport"},e.prototype.addEventListener=function(){this.parent.on("updateResults",this.updateExcelResultModel,this),this.parent.on("excelCellInfo",this.excelQueryCellInfo,this)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateResults",this.updateExcelResultModel),this.parent.off("excelCellInfo",this.excelQueryCellInfo))},e.prototype.updateExcelResultModel=function(e){this.dataResults=e},e.prototype.Map=function(e,n,o,a,s){var l=this,d=this.parent.flatData,p=Object();return t.setValue("isCsv",s,p),t.setValue("cancel",!1,p),new Promise(function(h,c){var u=l.isLocal()?new i.DataManager(d):l.parent.dataSource,g=new i.Query;if(l.isLocal()||(g=l.generateQuery(g),t.setValue("query",g,p)),l.parent.trigger(M,t.extend(p,e)),r.getObject("cancel",p))return null;u.executeQuery(g).then(function(t){return l.manipulateExportProperties(e,d,l.isLocal()?null:t),l.parent.grid.excelExportModule.Map(l.parent.grid,e,n,o,s,a)})})},e.prototype.generateQuery=function(e,i){return!t.isNullOrUndefined(i)&&"CurrentPage"===i.exportType&&this.parent.allowPaging&&(i.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=r.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},e.prototype.manipulateExportProperties=function(e,n,o){if(t.isNullOrUndefined(o))0===this.parent.grid.sortSettings.columns.length&&(this.parent.grid.filterSettings.columns.length>0||this.parent.grid.searchSettings.key)&&(n=this.parent.filterModule.filteredResult);else{this.parent.parentData=[],this.parent.dataModule.convertToFlatData(r.getObject("result",o));var a=Object();t.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),a),this.parent.notify("dataProcessor",a),a=this.dataResults,n=t.isNullOrUndefined(a.result)?this.parent.flatData.slice(0):a.result,this.parent.flatData=[]}return e=t.isNullOrUndefined(e)?Object():e,e.dataSource=new i.DataManager({json:n}),e},e.prototype.excelQueryCellInfo=function(e){if(this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex){var r={},i=e.data,n=t.isNullOrUndefined(i.filterLevel)?i.level:i.filterLevel;r.indent=n,e.style=r}this.parent.notify("updateResults",e),this.parent.trigger("excelQueryCellInfo",e)},e.prototype.isLocal=function(){return!o(this.parent)&&d(this.parent)},e}(),be=function(){function e(e){r.Grid.Inject(r.PdfExport),this.parent=e,this.dataResults={},this.addEventListener()}return e.prototype.getModuleName=function(){return"PdfExport"},e.prototype.addEventListener=function(){this.parent.on("pdfCellInfo",this.pdfQueryCellInfo,this),this.parent.on("updateResults",this.updatePdfResultModel,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("pdfCellInfo",this.pdfQueryCellInfo),this.parent.off("updateResults",this.updatePdfResultModel))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.updatePdfResultModel=function(e){this.dataResults=e},e.prototype.Map=function(e,n,a,s){var l=this,p=this.parent.flatData,h=Object();t.setValue("cancel",!1,h);var c=!o(this.parent)&&d(this.parent);return new Promise(function(o,d){var u=c?new i.DataManager(p):l.parent.dataSource,g=new i.Query;if(c||(g=l.generateQuery(g),t.setValue("query",g,h)),l.parent.trigger(P,t.extend(h,e)),r.getObject("cancel",h))return null;u.executeQuery(g).then(function(t){return l.manipulatePdfProperties(e,p,c?null:t),l.parent.grid.pdfExportModule.Map(l.parent.grid,e,n,a,s)})})},e.prototype.generateQuery=function(e,i){return!t.isNullOrUndefined(i)&&"CurrentPage"===i.exportType&&this.parent.allowPaging&&(i.exportType="AllPages",e.addParams("ExportType","CurrentPage"),e.where(this.parent.parentIdMapping,"equal",null),e=r.getObject("grid.renderModule.data.pageQuery",this.parent)(e)),e},e.prototype.manipulatePdfProperties=function(e,r,n){if(t.isNullOrUndefined(n))(this.parent.grid.filterSettings.columns.length>0||this.parent.grid.searchSettings.key)&&0===this.parent.grid.sortSettings.columns.length&&(r=this.parent.filterModule.filteredResult);else{this.parent.parentData=[];var o={};this.parent.dataModule.convertToFlatData(t.getValue("result",n)),t.setValue("query",this.parent.grid.getDataModule().generateQuery(!0),o),this.parent.notify("dataProcessor",o),o=this.dataResults,r=t.isNullOrUndefined(o.result)?this.parent.flatData.slice(0):o.result,this.parent.flatData=[]}return e=t.isNullOrUndefined(e)?{}:e,e.dataSource=new i.DataManager({json:r}),e},e.prototype.pdfQueryCellInfo=function(e){if(this.parent.grid.getColumnIndexByUid(e.column.uid)===this.parent.treeColumnIndex){var i={},n=r.getObject("data",e),o=t.isNullOrUndefined(n.filterLevel)?n.level:n.filterLevel;i.paragraphIndent=3*o,e.style=i}this.parent.notify("updateResults",e),this.parent.trigger("pdfQueryCellInfo",e)},e}(),Re=function(){function e(e){r.Grid.Inject(r.Page),this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(j,this.collapseExpandPagedchilds,this),this.parent.on(k,this.pageAction,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(j,this.collapseExpandPagedchilds),this.parent.off(k,this.pageAction))},e.prototype.getModuleName=function(){return"pager"},e.prototype.refresh=function(){this.parent.grid.pagerModule.refresh()},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.goToPage=function(e){this.parent.grid.pagerModule.goToPage(e)},e.prototype.updateExternalMessage=function(e){this.parent.grid.pagerModule.updateExternalMessage(e)},e.prototype.collapseExpandPagedchilds=function(e){e.record.expanded="collapse"!==e.action;var r={result:this.parent.flatData,row:e.row,action:e.action,record:e.record,count:this.parent.flatData.length};t.getValue("grid.renderModule",this.parent).dataManagerSuccess(r)},e.prototype.pageAction=function(e){var r=this,n=new i.DataManager(e.result);if("Root"===this.parent.pageSettings.pageSizeMode){var o=[],a=this.parent.grid.filterSettings.columns.length>0&&("Child"===this.parent.filterSettings.hierarchyMode||"None"===this.parent.filterSettings.hierarchyMode)?"filterLevel":"level",l=(new i.Query).where(a,"equal",0);o=n.executeLocal(l),e.count=o.length;var d=(m=this.parent.grid.pageSettings.pageSize)*(this.parent.grid.pageSettings.currentPage-1);l=l.skip(d).take(m),o=n.executeLocal(l);for(var p=[],h=function(r){p=e.result.filter(function(e){return t.isNullOrUndefined(o[r].filterIndex)?e.rootIndex===o[r].index:e.filterRootIndex===o[r].filterIndex});for(var i=0;i<p.length;i++)o.splice(r+i+1,0,p[i])},c=0;c<o.length;c++)h(c);e.result=o}else{var u=new i.DataManager(e.result),g=new i.Predicate("expanded","notequal",null).or("expanded","notequal",void 0),f=u.executeLocal((new i.Query).where(g)),y=f.filter(function(e){return s(r.parent,e,f)});e.count=y.length;var m;l=new i.Query,d=(m=this.parent.grid.pageSettings.pageSize)*(this.parent.grid.pageSettings.currentPage-1);l=l.skip(d).take(m),u.dataSource.json=y,e.result=u.executeLocal(l)}this.parent.notify("updateAction",e)},e}(),Se=function(){function e(e){r.Grid.Inject(r.Toolbar),this.parent=e}return e.prototype.getModuleName=function(){return"toolbar"},e.prototype.getToolbar=function(){return this.parent.grid.toolbarModule.getToolbar()},e.prototype.enableItems=function(e,t){this.parent.grid.toolbarModule.enableItems(e,t)},e.prototype.destroy=function(){},e}(),Me=function(){function e(e){r.Grid.Inject(r.Aggregate),this.parent=e,this.flatChildRecords=[],this.summaryQuery=[]}return e.prototype.getModuleName=function(){return"summary"},e.prototype.removeEventListener=function(){this.parent.isDestroyed},e.prototype.calculateSummaryValue=function(e,i,n){this.summaryQuery=e;var o,s;s=[];for(var l=0,d=Object.keys(i).length;l<d;l++){r.getObject("isSummaryRow",i[l])||s.push(i[l])}var p,h=a(s);p=s.slice();var c,u=Object.keys(this.parent.columns).length,g=Object.keys(this.parent.aggregates).length,f=0;for(d=Object.keys(h).length;f<d;f++){o=h[f],c=this.getChildRecordsLength(o,p);for(var y=function(e,i){var a=void 0;a={};for(var s=0,l=u;s<l;s++){a[t.isNullOrUndefined(r.getObject("field",m.parent.columns[s]))?m.parent.columns[s]:r.getObject("field",m.parent.columns[s])]=null}if(!m.parent.aggregates[e-1].showChildSummary)return"continue";a=m.createSummaryItem(a,m.parent.aggregates[e-1]);var d;p.map(function(e,t){e.uniqueID!==o.uniqueID||(d=t)});var h=d+c+e,g=t.extend({},o);delete g.childRecords,delete g[m.parent.childMapping],t.setValue("parentItem",g,a);var f=r.getObject("level",g);t.setValue("level",f+1,a);var y=r.getObject("index",g);if(t.setValue("parentIndex",y,a),t.setValue("isSummaryRow",!0,a),n){r.getObject("childRecords",o).push(a)}p.splice(h,0,a)},m=this,v=1,w=g;v<=w;v++)y(v);this.flatChildRecords=[]}return p},e.prototype.getChildRecordsLength=function(e,i){for(var n,o=0,a=Object.keys(i).length;o<a;o++){n=i[o];if(e===(t.isNullOrUndefined(n.parentItem)?null:i.filter(function(e){return e.uniqueID===n.parentItem.uniqueID})[0])){this.flatChildRecords.push(n);if(!r.getObject("hasChildRecords",n))continue;this.getChildRecordsLength(n,i)}}return this.flatChildRecords.length},e.prototype.createSummaryItem=function(e,r){for(var i=0,n=Object.keys(r.columns).length;i<n;i++)for(var o=t.isNullOrUndefined(r.columns[i].columnName)?r.columns[i].field:r.columns[i].columnName,a=0,s=Object.keys(e);a<s.length;a++){var l=s[a];l===o&&(e[l]=this.getSummaryValues(r.columns[i],this.flatChildRecords))}return e},e.prototype.getSummaryValues=function(e,n){var o,a=this,s=new i.Query;o={};var l={},d=t.isNullOrUndefined(e.field)?void 0:this.parent.getColumnByField(e.field).type;e.setPropertiesSilent({format:this.getFormatFromType(e.format,d)}),e.setFormatter(this.parent.grid.locale);var p=e.getFormatter()||function(e){return e};e.setTemplate(l);var h=e.getTemplate(2);s.queries=this.summaryQuery,s.requiresCount();var c,u=new i.DataManager(n).executeLocal(s);e.type;[e.type].forEach(function(i){c=i;var n=e.field+" - "+i.toLowerCase(),s="Custom"!==i?r.getObject("aggregates",u):r.calculateAggregate(i,u,e,a.parent),l=e.columnName,d="Custom"!==i?s[n]:s;o[l]=o[l]||{},o[l][n]=d,o[l][i]=t.isNullOrUndefined(s)?" ":p(d)}),l.format=e.getFormatter();var g=t.createElement("td",{className:"e-summary"});r.appendChildren(g,h.fn(o[e.columnName],this.parent,h.property));var f=o[e.columnName][c];return-1===g.innerHTML.indexOf(f)?g.innerHTML+f:g.innerHTML},e.prototype.getFormatFromType=function(e,r){if(t.isNullOrUndefined(r)||"string"!=typeof e)return e;var i;switch(r){case"number":i={format:e};break;case"datetime":i={type:"dateTime",skeleton:e};break;case"date":i={type:r,skeleton:e}}return i},e.prototype.destroy=function(){this.removeEventListener()},e}(),Pe=function(){function e(e){r.Grid.Inject(r.ContextMenu),this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on("contextMenuOpen",this.contextMenuOpen,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("contextMenuOpen",this.contextMenuOpen)},e.prototype.contextMenuOpen=function(e){var t=e.element.querySelector("#"+this.parent.element.id+"_gridcontrol_cmenu_AddRow");t&&(!1===this.parent.grid.editSettings.allowAdding?t.style.display="none":t.style.display="block")},e.prototype.getModuleName=function(){return"contextMenu"},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.getContextMenu=function(){return this.parent.grid.contextMenuModule.getContextMenu()},e}(),Ee=function(){function e(e){r.Grid.Inject(r.Edit),this.parent=e,this.isSelfReference=!t.isNullOrUndefined(e.parentIdMapping),this.addEventListener()}return e.prototype.getModuleName=function(){return"edit"},e.prototype.addEventListener=function(){this.parent.on(L,this.editAction,this),this.parent.on(F,this.beginEdit,this),this.parent.on(U,this.beginAdd,this),this.parent.on(q,this.recordDoubleClick,this),this.parent.on(B,this.cellSave,this),this.parent.on(V,this.batchCancel,this),this.parent.grid.on(Q,this.keyPressed,this),this.parent.on(_,this.cellEdit,this),this.parent.grid.on(H,this.recordDoubleClick,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(L,this.editAction),this.parent.off(F,this.beginEdit),this.parent.off(U,this.beginAdd),this.parent.off(q,this.recordDoubleClick),this.parent.off(B,this.cellSave),this.parent.off(V,this.batchCancel),this.parent.grid.off(Q,this.keyPressed),this.parent.off(_,this.cellEdit),this.parent.grid.off(H,this.recordDoubleClick))},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.applyFormValidation=function(e){this.parent.grid.editModule.applyFormValidation(e)},e.prototype.recordDoubleClick=function(e){var t=e.target;this.doubleClickTarget=t;var r=this.parent.grid.getColumnByIndex(+t.closest("td").getAttribute("aria-colindex"));"Cell"!==this.parent.editSettings.mode||this.isOnBatch||!r||r.isPrimaryKey||!r.allowEditing||t.classList.contains("e-treegridexpand")||t.classList.contains("e-treegridcollapse")||(this.isOnBatch=!0,this.parent.grid.editSettings.mode="Batch",this.parent.grid.dataBind())},e.prototype.keyPressed=function(e){this.isOnBatch&&(this.keyPress=e.action)},e.prototype.cellEdit=function(e){if(this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")))return e.cancel=!0,void(this.doubleClickTarget=null);"Cell"===this.parent.editSettings.mode&&("tab"===this.keyPress||"shiftTab"===this.keyPress?this.keyPress=null:"enter"===this.keyPress&&(e.cancel=!0,this.keyPress=null),this.enableToolbarItems())},e.prototype.enableToolbarItems=function(){if(!t.isNullOrUndefined(this.parent.grid.toolbarModule)){var e=this.parent.element.id+"_gridcontrol_";this.parent.grid.toolbarModule.enableItems([e+"add",e+"edit",e+"delete"],!1),this.parent.grid.toolbarModule.enableItems([e+"update",e+"cancel"],!0)}},e.prototype.batchCancel=function(e){"Cell"===this.parent.editSettings.mode&&(this.parent.renderModule.cellRender({data:this.parent.grid.getSelectedRecords()[0],cell:this.parent.grid.getSelectedRows()[0].cells[this.parent.treeColumnIndex],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex]}),this.parent.grid.editSettings.mode="Normal",this.parent.grid.dataBind(),this.isOnBatch=!1)},e.prototype.cellSave=function(e){if("Cell"===this.parent.editSettings.mode){e.cancel=!0,"tab"!==this.keyPress&&"shiftTab"!==this.keyPress&&(this.parent.grid.closeEdit(),this.isOnBatch=!1),t.setValue("isEdit",!1,this.parent.grid),e.rowData[e.columnName]=e.value;var r,i=e.cell.parentNode;if(t.isNullOrUndefined(i)){var n=this.parent.getPrimaryKeyFieldNames()[0];this.parent.grid.getCurrentViewRecords().filter(function(t,i){t[n]!==e.rowData[n]||(r=i)})}else r=i.rowIndex;this.parent.cellEditedColumn=e.columnName,i=this.parent.grid.getRows()[r],this.parent.grid.editModule.updateRow(r,e.rowData),this.enableToolbarItems(),this.parent.grid.editModule.formObj.destroy(),"tab"!==this.keyPress&&"shiftTab"!==this.keyPress&&(this.parent.grid.editSettings.mode="Normal",this.parent.grid.dataBind()),t.removeClass([i],["e-editedrow","e-batchrow"]),t.removeClass(i.querySelectorAll(".e-rowcell"),["e-editedbatchcell","e-updatedtd"]),this.editAction({value:e.rowData,action:"edit"})}},e.prototype.beginAdd=function(e){var r,i=this.addRowIndex,n=this.parent.grid.getCurrentViewRecords(),o=this.parent.grid.getDataRows();if("Dialog"!==this.parent.editSettings.mode&&("Child"!==this.parent.editSettings.newRowPosition||n[i].expanded||this.parent.expandRow(o[i+1],n[i]),"Above"===this.parent.editSettings.newRowPosition?r="before":("Below"===this.parent.editSettings.newRowPosition||"Child"===this.parent.editSettings.newRowPosition)&&this.selectedIndex>-1&&(r="after",i+=l(n[i]).length),this.selectedIndex>-1&&(i||"Child"===this.parent.editSettings.newRowPosition||"Below"===this.parent.editSettings.newRowPosition))){i>=o.length&&(i=o.length-2);var a=document.activeElement;if(o[i+1][r](o[0]),"Row"===this.parent.editSettings.mode||"Cell"===this.parent.editSettings.mode){for(var s=this.parent.grid.getContentTable().querySelectorAll(".e-griderror"),d=0;d<s.length;d++)s[d].remove();t.setValue("errorRules",[],this.parent.grid.editModule.formObj)}a.focus()}},e.prototype.beginEdit=function(e){if("refresh"===e.requestType&&this.isOnBatch)e.cancel=!0;else if("Cell"!==this.parent.editSettings.mode||"beginEdit"!==e.requestType){if(this.doubleClickTarget&&(this.doubleClickTarget.classList.contains("e-treegridexpand")||this.doubleClickTarget.classList.contains("e-treegridcollapse")))return e.cancel=!0,void(this.doubleClickTarget=null);if("delete"===e.requestType)for(var t=e.data,r=0;r<t.length;r++)e.data=t.concat(l(t[r]));"add"===e.requestType&&(this.selectedIndex=this.parent.grid.selectedRowIndex,this.addRowIndex=this.parent.grid.selectedRowIndex>-1?this.parent.grid.selectedRowIndex:0),e=this.beginAddEdit(e)}else e.cancel=!0},e.prototype.beginAddEdit=function(e){var n=e.data;if("add"===e.action){var o=this.parent.grid.getPrimaryKeyFieldNames()[0],a=null,s=this.parent.grid.getCurrentViewRecords(),d=this.addRowIndex;n.uniqueID=r.getUid(this.parent.element.id+"_data_");var p=void 0,h=void 0,c=void 0,u=void 0,g=void 0,f=void 0,y=void 0;if(s.length&&(p=s[this.addRowIndex].level,h=s[this.addRowIndex].index,c=s[this.addRowIndex][this.parent.idMapping],u=s[this.addRowIndex].parentIndex,y=s[this.addRowIndex][this.parent.parentIdMapping],s[this.addRowIndex].parentItem&&(g=s[this.addRowIndex].parentItem.uniqueID),f=s[this.addRowIndex].parentItem),"Top"!==this.parent.editSettings.newRowPosition&&("Above"===this.parent.editSettings.newRowPosition?a="before":"Below"===this.parent.editSettings.newRowPosition?(a="after",d+=l(s[this.addRowIndex]).length):"Child"===this.parent.editSettings.newRowPosition&&(a="after",this.selectedIndex>-1&&(n.parentIndex=h,n.parentItem=t.extend({},s[this.addRowIndex]),n.parentUniqueID=n.parentItem.uniqueID,delete n.parentItem.childRecords,delete n.parentItem[this.parent.childMapping]),d+=l(s[this.addRowIndex]).length,n.level=p+1,this.isSelfReference&&(n[this.parent.parentIdMapping]=c,t.isNullOrUndefined(n.parentIndex)||this.updateParentRow(o,n.parentItem,"add",n))),"Above"!==this.parent.editSettings.newRowPosition&&"Below"!==this.parent.editSettings.newRowPosition||(this.selectedIndex>-1&&p&&(n.parentIndex=u,n.parentUniqueID=g,n.parentItem=t.extend({},f),delete n.parentItem.childRecords,delete n.parentItem[this.parent.childMapping]),n.level=p,this.isSelfReference&&(n[this.parent.parentIdMapping]=y,t.isNullOrUndefined(n.parentIndex)||this.updateParentRow(o,n.parentItem,"add",n))),null!=a&&this.selectedIndex>-1&&(e.index="before"===a?d:d+1),"Bottom"===this.parent.editSettings.newRowPosition)){var m=this.parent.grid.dataSource instanceof i.DataManager?this.parent.grid.dataSource.dataSource.json:this.parent.grid.dataSource;e.index=m.length}n.hasChildRecords=!1,n.childRecords=[],n.index=0}return e},e.prototype.addAction=function(e,r){var i,n=!1,o=this.parent.grid.getCurrentViewRecords();switch(i=t.extend({},e.value),i=h(i),this.parent.editSettings.newRowPosition){case"Top":r.unshift(i),n=!0;break;case"Bottom":r.push(i),n=!0;break;case"Above":i=o[this.addRowIndex+1];break;case"Below":case"Child":i=o[this.addRowIndex],-1===this.selectedIndex&&(r.unshift(i),n=!0)}return{value:i,isSkip:n}},e.prototype.editAction=function(e){var r=this,n=e.value,o=e.action;"save"===o&&(o="edit");var a,s,l=this.parent.grid.getPrimaryKeyFieldNames()[0],d=this.parent.dataSource instanceof i.DataManager?this.parent.dataSource.dataSource.json:this.parent.dataSource,h=[],c=n,u=!1;this.parent.grid.getCurrentViewRecords();if("add"===o){var g=this.addAction(e,d);n=g.value,u=g.isSkip}if(n instanceof Array?h=p(n):h.push(t.extend({},n)),!u&&("add"!==o||"Top"!==this.parent.editSettings.newRowPosition&&"Bottom"!==this.parent.editSettings.newRowPosition))for(var f=0;f<h.length;f++){var y=Object.keys(h[f]);a=d.length;for(var m=function(){if(d[a][l]===h[f][l]){if("delete"!==o){if("edit"===o)for(s=0;s<y.length;s++)d[a].hasOwnProperty(y[s])&&(d[a][y[s]]=h[f][y[s]]);else if("add"===o){var e=void 0;"Child"===v.parent.editSettings.newRowPosition?v.isSelfReference?(c[v.parent.parentIdMapping]=d[a][v.parent.idMapping],d.splice(a+1,0,c)):(d[a].hasOwnProperty(v.parent.childMapping)||(d[a][v.parent.childMapping]=[]),d[a][v.parent.childMapping].push(c),v.updateParentRow(l,d[a],o)):"Below"===v.parent.editSettings.newRowPosition?d.splice(a+1,0,c):v.addRowIndex?"Above"===v.parent.editSettings.newRowPosition&&d.splice(a,0,c):(e=0,d.splice(e,0,c))}return"break"}var i=d[a];if(d.splice(a,1),v.isSelfReference){if(!t.isNullOrUndefined(i[v.parent.parentIdMapping]))for(var n=v.parent.flatData.filter(function(e){return e[r.parent.idMapping]===i[r.parent.parentIdMapping]})[0],p=n?n[v.parent.childMapping]:[],u=p.length-1;u>=0;u--)if(p[u][v.parent.idMapping]===i[v.parent.idMapping]){p.splice(u,1),p.length||(n.hasChildRecords=!1,v.updateParentRow(l,n,o));break}return"break"}}else t.isNullOrUndefined(d[a][v.parent.childMapping])||v.removeChildRecords(d[a][v.parent.childMapping],h[f],o,l,c)&&v.updateParentRow(l,d[a],o)},v=this;a--&&a>=0;){if("break"===m())break}}},e.prototype.removeChildRecords=function(e,r,i,n,o){for(var a=!1,s=e.length;s--&&s>=0;)if(e[s][n]===r[n]||this.isSelfReference&&e[s][this.parent.parentIdMapping]===r[this.parent.idMapping]){if("edit"===i){for(var l=Object.keys(r),d=0;d<l.length;d++)e[s].hasOwnProperty(l[d])&&(e[s][l[d]]=r[l[d]]);break}if("add"===i)"Child"===this.parent.editSettings.newRowPosition?this.isSelfReference?(o[this.parent.parentIdMapping]=e[s][this.parent.idMapping],e.splice(s+1,0,o),this.updateParentRow(n,e[s],i)):(e[s].hasOwnProperty(this.parent.childMapping)||(e[s][this.parent.childMapping]=[]),e[s][this.parent.childMapping].push(o),this.updateParentRow(n,e[s],i)):"Above"===this.parent.editSettings.newRowPosition?e.splice(s,0,o):"Below"===this.parent.editSettings.newRowPosition&&e.splice(s+1,0,o);else{e[s].parentItem;e.splice(s,1),e.length||(a=!0)}}else t.isNullOrUndefined(e[s][this.parent.childMapping])||this.removeChildRecords(e[s][this.parent.childMapping],r,i,n,o)&&this.updateParentRow(n,e[s],i);return a},e.prototype.updateParentRow=function(e,t,r,i){var n,o=this.parent.grid.getCurrentViewRecords();if(o.map(function(r,i){r[e]!==t[e]||(n=i)}),t=o[n],t.hasChildRecords=!1,"add"===r){t.expanded=!0,t.hasChildRecords=!0;var a=i||o[n+1];t.hasOwnProperty("childRecords")||(t.childRecords=[]),-1===t.childRecords.indexOf(a)&&t.childRecords.unshift(a),this.isSelfReference&&(t.hasOwnProperty(this.parent.childMapping)||(t[this.parent.childMapping]=[]),-1===t.childRecords.indexOf(a)&&t[this.parent.childMapping].unshift(a))}this.parent.grid.setRowData(e,t);var s=this.parent.getRowByIndex(n);this.parent.renderModule.cellRender({data:t,cell:s.cells[this.parent.treeColumnIndex],column:this.parent.grid.getColumns()[this.parent.treeColumnIndex]})},e.prototype.editFormValidate=function(){return this.parent.grid.editModule.editFormValidate()},e.prototype.destroyForm=function(){this.parent.grid.editModule.destroyForm()},e}(),Ie=function(){function e(e){r.Grid.Inject(r.CommandColumn),this.parent=e}return e.prototype.getModuleName=function(){return"commandColumn"},e.prototype.destroy=function(){},e}();e.TreeGrid=me,e.load="load",e.rowDataBound=m,e.dataBound="dataBound",e.queryCellInfo=v,e.beforeDataBound=w,e.actionBegin=x,e.actionComplete=C,e.rowSelected=b,e.rowDeselected=R,e.toolbarClick=S,e.beforeExcelExport=M,e.beforePdfExport=P,e.resizeStop=E,e.expanded=I,e.expanding="expanding",e.collapsed=O,e.collapsing=D,e.remoteExpand=A,e.localPagedExpandCollapse=j,e.pagingActions=k,e.printGridInit=N,e.contextMenuOpen=T,e.crudAction=L,e.beginEdit=F,e.beginAdd=U,e.recordDoubleClick=q,e.cellSave=B,e.cellSaved="cellSaved",e.cellEdit=_,e.batchDelete="batchDelete",e.batchCancel=V,e.batchAdd="batchAdd",e.beforeBatchAdd="beforeBatchAdd",e.beforeBatchSave="beforeBatchSave",e.batchSave="batchSave",e.keyPressed=Q,e.updateData="update-data",e.doubleTap=H,e.DataManipulation=ee,e.Reorder=ve,e.Resize=we,e.Column=c,e.EditSettings=pe,e.FilterSettings=f,e.PageSettings=ie,e.SearchSettings=K,e.SelectionSettings=Y,e.AggregateColumn=ae,e.AggregateRow=se,e.Render=Z,e.isRemoteData=o,e.findParentRecords=a,e.getExpandStatus=s,e.findChildrenRecords=l,e.isOffline=d,e.extendArray=p,e.getPlainData=h,e.Filter=xe,e.ExcelExport=Ce,e.PdfExport=be,e.Page=Re,e.Toolbar=Se,e.Aggregate=Me,e.Sort=$,e.ColumnMenu=y,e.ContextMenu=Pe,e.Edit=Ee,e.CommandColumn=Ie,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-treegrid.umd.min.js.map
